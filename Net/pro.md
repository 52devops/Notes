# 协议
## 点对点
- SLIP(Serial Line IP):串行线路IP、
  - **点对点**通信。
  - 结尾传入特殊的END字符**0xc0**结束.为了保证传输数据的不被干扰，在数据开始时也发送一个END结束。如果数据中含有该值则用**0xdb0xdc**取代。
  - 特殊符1比特
> 由此点对点特性可以看出每一端必须知道对端地址，并且一跳串行线路只能跑一个SLIP,不能跑其他协议。并且数据帧中没有校验和。效率较低，如果为交互性操作，可能传送一个字节数据需要40字节的IP和TCP首部。改进版CSLIP，将SLIP的IPTCP首部压缩至3-5字节。
- PPP():SLIP升级版
  - 支持8位和奇偶校验，能够在串行链路上封装IP数据报。
  - 开始结束都为标志字符**0x7e**,数据中出现该值则用**0x7d0x5e**代替
  - 一个串行线路支持多种协议
## ARP
```!
地址解析协议，用来将地址解析为对应的48bit的MAC地址。
用来在IP包到达主机所在网络后，确定主机位置的协议
主机会将ARP请求发送到**ff:ff:ff:ff:ff:ff**,这个地址是以太网广播地址
Request who-has vm2 tell vm1, length 28
Reply vm2 is-at 00:1c:42:e4:ae:33 (oui Unknown), length
```
- ARP缓存
  加快速度，每个节点都有一个ARP缓存表，用来记录对应信息
- ARP代理
  请求从一个网络主机发到另一个网络上主机，网络间的路由会回答该请求。包会交给该路由处理
- 免费ARP
  主机启动引导时进行，用来检测是否有IP冲突或者改变MAC地址进行广播
## RARP
ARP的逆向，由MAC到IP的解析。可在网络引导时见到
## ICMP
用来传递一些控制信息,尤其是**ICMP差错报文**
----
通过不同ICMP类型、代码实现不同的功能。常见的有ICMP.echo() ICMP.reply
##分为两大类：
- 查询
- 差错
ICMP的差错报文通常用来表达一些事物的完成情况，但为了不让其进入到一个无限循环如“出了错误，引起差错，然后再引起差错”这种情况。有几种情况是只产生一次差错报文:
- ICMP差错报文（本身不会再出发差错报文）
- 目的地址是广播/多播地址
- 作为链路层广播数据报
- 不是IP分片的第一片
- 源地址不是单个主机的数据包 源地址不能为0 回环地址 广播/多播地址
以上规则防止了无限产生差错报文，从而引起广播风暴。
- ICMP端口不可达
  报文不能与端口进行通信。traceroute原理
差错报文必须包括触发该报文生成的差错报文的数据报IP首部
## UDP
首部8字节
无连接，快，不靠谱
- 可选校验和
  - 覆盖首部和数据部分的校验和
- IP分片
  - UDP自身没有防分片策略，索引容易引起分片
如果一个路由接收到需要分片的数据报，但IP首部设置不分片，那么就会产生差错报文，利用该机制发现MTU值。

## 广播多播单播
广播多播仅用于UDP协议<br>
多播介于 广播和单播之间，只将帧发送给属于多播组的多个主机<br>
单播是指定了帧发往单个主机，其目的地址指向单个接收接口。<br>
###接收的过程
- 网卡查看链路过来的帧
- 目的地址如果是广播地址或本机地址则接收
- 将帧扔给驱动程序，设备驱动解析其协议
- 根据协议内容继续交给下一层
- 如果主机中没有进程使用帧中的地址端口等，会触发ICMP不可达报文
